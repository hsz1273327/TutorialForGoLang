# Golang攻略

Golang至少在当前的1.x阶段是一门相当简陋的语言.它可以理解为是C语言的直接升级版:

+ 取消了头文件,改用命名的大写首字母来标明接口,使用接口(函数或属性签名)来作为类型限制
+ 加上了gc和runtime,防止滥用malloc造成的内存溢出,同时提供了运行时反射
+ 加上了原生的的并发封装,开发者不用再关心什么线程协程进程的问题
+ 加上了对匿名函数的支持,方便构造回调.
+ 加快了编译时间
+ 加上了原生的多平台交叉编译功能
+ 取消了对指针的的直接操作防止被滥用
+ 取消了宏,防止被滥用
+ 取消了空指针,防止被滥用
+ 加上了`go get`命令用于依赖下载和安装,在1.11版本之后进一步加入了module系统用于控制单独项目的依赖(cmake)
+ 加上了`Gofmt`命令控制编码风格,防止像C代码一样多种风格并存
+ 加上了`go test`命令,并提供了统一的测试方案

可以看到go语言主要就是针对C语言开发的痛点进行了一些改进,它并没有加入什么新的编程范式,也没有显式的加入现代编程语言的特性.什么fp,oop一个都没有,但它在防止特性被滥用和统一周边工具链上下了功夫,也为高并发编程降低了心智负担.

虽然看了上面它对C语言的改进这么多,但要知道C语言是一门古老简陋的语言,即便有了上面的改进,Go语言的槽点一点也不少

1. 没有泛型(1.18.0版本后开始正式支持),这个是最大的槽点,C语言中还可以用宏部分的解决这个问题,在Go中就无解了,你只能要么牺牲性能使用`interface{}`然后靠运行时反射实现,要么通过第三方的代码生成器在程序外解决,相当不方便,C语言的主战场是系统编程,嵌入式软件和高性能科学计算,这种往往确实不需要泛型编程.但作为一门现代通用语言这就很尴尬了.好在泛型已经成为了计划中的特性并且在逐步实施,也算是千呼万唤始出来.
2. 没有异常系统,代码里大量的`if err != nil`非常丑陋.好在该特性也已经在计划中.
3. 编译出来的软件默认为静态编译,太大.虽然编译速度快了,但大小却变得大多了,于是go语言基本告别嵌入式领域(基于arm的linux编程不算)

这3个槽点让我在go早期完全无法接受,不过go语言官博上已经预告了2.0版本会增加泛型和异常系统,这让我重新有了写起相关攻略的动力.

## Go的定位

Go语言早期定位是系统语言,即对标的竞品是C/C++,然而由于上面的槽点,以及对指针的使用限制过严,性能也只能说上限是C这个级别,正常的Go程序往往性能与java的差不多(毕竟都有runtime),因此这个定位基本也就说说而已.

但很快的工程师们发现了它真正的用武之地:

1. 网络编程(低心智负担就可以实现高并发)
2. 网络中间件(本质上还是网络编程)
3. 分布式系统(本质上还是网络编程)
4. 云计算系统(本质上还是网络编程)
5. 区块链(本质上还是网络编程)

于是go在网络编程一块异军突起,实质上在和java竞争.

现在go的开发人员似乎也已经不再提什么系统编程了,而是强调可扩展性,这点上确实没啥可黑的,所有工程师使用一样的工具链,加上语法层面上实在是过于简单,学习成本相当低,这会让所有人写出来的代码在形式上看起来都差不多,自然也就增强了可维护性,也更加利于扩展.这点上确实没有哪门语言可以和它媲美.但也正是这点让它显得不近人情,坐实了自己是"搬砖工具".

总结go的比较优势就在于:

1. 与动态语言相比性能优异,省内存
2. 与大多数语言相比部署简单(自带交叉编译,默认静态链接)
3. 与C++,java等语言相比语法简单学习成本低
4. 与C,C++相比编译更快,依赖管理更现代化
5. 与大多数语言相比并发编程省心智负担
6. 与大多数语言相比规范更加统一(强制性的)因此可以带来维护效率上的提升

记住[没有银弹](https://baike.baidu.com/item/%E6%B2%A1%E6%9C%89%E9%93%B6%E5%BC%B9),go也只适合做它适合的工作而已.

## 本文需要的先验知识

1. linux命令行操作
2. 基本的编程概念,比如看过我的python攻略

## 本文描述的环境

本文基于go v1.16.0及以上版本,早期版本并未验证.待到有关键性特性的版本更新时我会尽快将其写入本攻略并注明最低版本要求.

## 本文针对人群和内容范围

老实说go语言并不适合完全不懂编程的人学,它本身是简单,语言内部集成的东西是少,但编程本身不是一件简单的事情,这就造成了需要有大量语言本身之外的知识来支撑起编程这件事.这点也是和c语言一样.如果你是一个编程新手,还是建议从[python](https://tutorialforpython.github.io/)入手,因为go语言多少受到了python的影响.而我给的文章也都更偏向应用并不适合纯新手学习,新手最好是找些更加基础的教程.

当然其实如果是光看这篇教程,那其实也不需要太高的水平,本质上这篇攻略是上手向的,只是因为不用[IDE](https://baike.baidu.com/item/%E9%9B%86%E6%88%90%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/298524?fr=aladdin)而且全部在命令行中操作所以可能外行看起来"比较高端".只要突破了这个障碍,这篇攻略应该只是一篇毫无难度的介绍文章而已.

另外提醒下读者不要对go的技巧有什么期待.go这种强调工程上实用性的语言没有奇技淫巧,只有规范,可玩性几乎为0.

本文内容也不多,只有3个篇章,至于语法直接去看[Go指南](https://tour.go-zh.org/welcome/1)好了,有说明有代码.

1. 工具链

    这部分讲官方提供的工具和如何配置工作环境

2. 特殊语法

    这部分按主题介绍一些Golang中的特殊语法或者惯用法,请一定先看好[Go指南](https://tour.go-zh.org/welcome/1),然后再看这部分,算是个语法介绍的补充

3. 网络编程实战

    这部分并不是讲socket,而是如何使用一些成熟框架构造接口服务

另外补一句,本文不详细介绍cgo,因为cgo的性能比上不足比下有余略鸡肋.go只适合做io密集型的网络编程,计算密集型的任务还是交给c/c++比较靠谱.
